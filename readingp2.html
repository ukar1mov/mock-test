<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sevenplus ‚Äî Reading (Passage 2)</title>
<link rel="icon" href="./favicon/favicon-180.png" sizes="32x32">
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<meta name="theme-color" content="#1aa2c9">
<style>
  :root{--brand-blue:#1aa2c9;--brand-gray:#55595c;--bg:#f7f9fb;--panel:#fff;--text:#1b1f23;--line:#e5e8eb}
  [data-theme="dark"]{--bg:#0e1116;--panel:#141922;--text:#e6edf3;--line:#2a2f38}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto}
  .appbar{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--line);display:flex;gap:12px;align-items:center;padding:10px 16px;z-index:10}
  .logo-text{font-size:1.2rem;text-decoration:none}
  .meta{margin-left:auto;display:flex;gap:10px;align-items:center}
  .btn{border:1px solid var(--line);background:var(--panel);padding:.55rem .9rem;border-radius:10px;cursor:pointer}
  .btn.primary{background:var(--brand-blue);color:#fff;border-color:var(--brand-blue)}
  .btn.ghost{background:transparent}
  .btn.active{background:var(--brand-blue);color:#fff;border-color:var(--brand-blue);pointer-events:none}
  main{max-width:1200px;margin:16px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
  .toolbar{display:flex;gap:8px;align-items:center;border:1px dashed var(--line);padding:8px;border-radius:10px;margin:10px 0}
  .swatch{width:20px;height:20px;border-radius:4px;border:1px solid var(--line);cursor:pointer}
  .swatch.yellow{background:#fff59d}
  .swatch.green{background:#c8e6c9}
  .swatch.eraser{display:flex;align-items:center;justify-content:center;font-size:14px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .panel{min-height:60vh;max-height:calc(100vh - 150px);overflow:auto;border:1px solid var(--line);border-radius:12px;padding:16px;background:var(--panel)}
  h1,h2,h3{margin:.2rem 0}
  .note{color:#667085}
  .qblock{border:1px solid var(--line);border-radius:12px;padding:12px;margin:10px 0}
  .options{display:grid;gap:6px;margin-top:8px}
  input[type=text]{padding:.5rem .6rem;border:1px solid var(--line);border-radius:10px}
  select{width:100%;padding:.5rem .6rem;border:1px solid var(--line);border-radius:10px;background:var(--panel)}
  footer.nav{display:flex;gap:8px;justify-content:center;margin:14px 0}
  footer.nav a{ text-decoration:none }
  .timer{margin-left:8px;padding:.25rem .55rem;border:1px solid var(--line);border-radius:10px;background:var(--panel);font-weight:600;color:var(--brand-blue);min-width:64px;text-align:center}
  .hl{display:inline;padding:0;border:0;line-height:inherit;font:inherit}
  .hl-yellow{background-color:#fff59d}
  .hl-green{background-color:#c8e6c9}
  .qnav{display:flex;gap:6px;flex-wrap:wrap;margin:12px 0}
  .qnav button{width:34px;height:34px;border:1px solid var(--line);border-radius:6px;background:#fff;cursor:pointer}
  .qnav button.done{background:#1fb66a;color:#fff;font-weight:600;border-color:#1fb66a}
  .qnav button.active{outline:2px solid var(--brand-blue)}
  @keyframes pulseGreen{0%{box-shadow:0 0 0 0 rgba(31,182,106,.6)}70%{box-shadow:0 0 0 10px rgba(31,182,106,0)}100%{box-shadow:none}}
  [data-theme="dark"] .qnav button{background:var(--panel)}

  /* Bold the first (number) column in the tables */
  .match-table th:first-child,
  .match-table td:first-child{font-weight:700}

  /* Inline blanks for Q24‚Äì26 */
  .inline-q p{margin:.4rem 0}
  .inline-q input.inline-input{
    display:inline-block;
    width:12ch;
    margin:0 .35rem;
    vertical-align:baseline;
  }
</style>
</head>
<body>
<header class="appbar">
  <span class="logo-text"><strong style="color:var(--brand-blue)">seven</strong><strong style="color:var(--brand-gray)">plus</strong></span>
  <span id="timer" class="timer" aria-live="polite">60:00</span>
  <div class="meta">
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
      <input id="themeToggle" type="checkbox" />
      <span>üåì</span>
    </label>
  </div>
</header>

<main>
  <div class="card">
    <div class="toolbar"><span>Highlighter:</span>
      <button class="swatch yellow" data-hl="yellow" title="Yellow"></button>
      <button class="swatch green" data-hl="green" title="Green"></button>
      <button class="swatch eraser" id="hl-eraser" title="Eraser">üßΩ</button>
    </div>

    <div class="grid">
      <!-- LEFT: PASSAGE (scrollable) -->
      <article id="passage" class="panel" tabindex="0">
        <h2>READING PASSAGE 2</h2>
        <p class="note">You should spend about 20 minutes on Questions 14‚Äì26 which are based on Reading Passage 2.</p>

        <h2 style="text-align:center">The purpose of facial expressions</h2>
        <p style="text-align:center"><em>Do facial expressions reflect inner feelings? Or are they social devices for influencing others?</em></p>

        <p><strong>A</strong> The use of facial expressions for measuring people's emotions has dominated psychology since the late 1960s. This was when Paul Ekman of the University of California pioneered the idea that, by carefully measuring facial expression, he could evaluate people's true emotions. Ekman carried out experiments in which people were asked to label photos of basic facial expressions such as a smile, frown or scowl with words for emotions. He found, for example, that a smile represented joy and a scowl represented anger. In fact, since the 1970s Ekman has dominated the field of emotion research with his theory that when an emotion occurs, a large number of electrical impulses also occur, creating specific facial expressions and other physiological changes, such as increased or decreased heart rate or heightened blood pressure.</p>

        <p><strong>B</strong> Many took Ekman's work to imply that facial expressions precisely indicated people's feelings. However, this theory has been attacked by a number of psychologists, such as Alan Fridlund of the University of California, who claim that there is no one-to-one correspondence between facial expressions and emotions. Expressions evolved to set off certain behaviors in other people, says Fridlund. So a smile may prompt people to approach, a scowl may warn them to stay away, and a look of sadness may elicit words of sympathy and reassurance. In other words, in Fridlund's view, facial expressions are inherently social: they involve not one, but two or more people. Even when people are alone they are holding a dialog with another person internally, or imagining themselves in a social situation.</p>

        <p><strong>C</strong> Thus Fridlund thinks of facial expressions as tools for influencing social interactions, a view which, he claims, enables us to begin predicting when certain facial expressions will occur. This in turn will allow more precise theories about social interactions. His studies find that expressions occur most often during pivotal points‚Äîthe turning points in social interactions during greetings, social crises, or times of appeasement, for example. At these pivotal points there is an approach, or closeness, or more intimacy, and facial expressions, as well as gestures, open up the possibilities of various social interactions.</p>

        <p><strong>D</strong> Although much work on the emotions relies on a link between facial expression and emotions, psychologist James Russell, of the University of British Columbia, says there is very little evidence supporting such a connection. ‚ÄúThere's some sense in which faces express emotion, but only in the sense that everything expresses emotion,‚Äù says Russell, a long-time critic of the expression-emotion link. ‚ÄúMusic does, posture does, words do, tone of voice does, your behavior does.‚Äù The real question is, ‚ÄúIs there anything special about faces?‚Äù And there we really do not know much. What is more likely, argues Russell, is that facial expressions tell others something about a person's overall mood and context, rather than provide details about specific emotions.</p>

        <p><strong>E</strong> Others, including Ekman, argue that the face can display information about emotions, but they admit that it is not reliable one hundred percent of the time. And those who only examine faces when trying to study emotion will jump to false conclusions. But according to Ekman, to say, as Fridlund does, that there is no connection at all between facial expressions and emotions is simply wrong. ‚ÄúThere is a link between facial expression and emotion,‚Äù agrees developmental psychologist Linda Camras of DePaul University, ‚Äúbut it's not a one-to-one kind of relationship as many once thought.‚Äù She believes there are many situations where emotion is experienced, yet no basic facial expression is displayed. And there are times when a facial expression appears with no corresponding emotion.</p>

        <p><strong>F</strong> Ekman's theory states that if the emotion comes on slowly or is rather weak, the feeling might not be strong enough to trigger the expression. This would explain why there can sometimes be emotion without expression, he argues. In addition, cultural rules which determine when and whether people of certain cultures display emotional expressions can prevent this otherwise automatic process from being completed. Facial expressions evolved in humans as signals to others about how they feel, says Ekman. At times, though, it may be uncomfortable or inconvenient for us to let others know our emotions. But in the long run, over the course of evolution, it was useful to us as signalers: an angry look on someone's face may be a warning that they are preparing to behave in an angry fashion.</p>

        <p><strong>G</strong> Although Fridlund disagrees with Ekman on certain matters, the two basically share the opinion that facial expressions indicate people's future actions. The area of dispute between Fridlund and Ekman draws attention away from their major areas of agreement, says Joseph Campos of the University of California. Indeed, he says, ‚Äúthere is profound agreement that the face, along with the voice, body posture and hand gestures, forecasts to outside observers what people will do next.‚Äù He goes on to say, ‚ÄúThe face is a component [of emotion], but to make it the center of study of the human being experiencing an emotion is like saying the only thing you need to study in a car is the transmission. Not that the transmission is unimportant, but it's only part of an entire system.‚Äù</p>

        <!-- Numbered navigation boxes 14‚Äì26 -->
        <div class="qnav" id="qnav">
          <button data-q="q14">14</button><button data-q="q15">15</button><button data-q="q16">16</button><button data-q="q17">17</button><button data-q="q18">18</button><button data-q="q19">19</button><button data-q="q20">20</button><button data-q="q21">21</button><button data-q="q22">22</button><button data-q="q23">23</button><button data-q="q24">24</button><button data-q="q25">25</button><button data-q="q26">26</button>
        </div>
      </article>

      <!-- RIGHT: QUESTIONS (scrollable) -->
      <aside id="questions" class="panel" tabindex="0">
        <h3>Questions 14‚Äì18</h3>
        <p>Reading Passage 2 has seven paragraphs, <strong>A‚ÄìG</strong>. Which paragraph contains the following information? Write the correct letter, <strong>A‚ÄìG</strong>, in boxes 14‚Äì18 on your answer sheet.</p>

        <div class="qblock">
          <table class="match-table" aria-label="Which paragraph contains information">
            <thead><tr><th>Q</th><th>Statement</th><th>Answer (A‚ÄìG)</th></tr></thead>
            <tbody>
              <tr id="q14">
                <td>14.</td>
                <td>a recognition that facial expressions do not always provide a true guide to feelings.</td>
                <td>
                  <select id="P2_FI_14">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option>
                  </select>
                </td>
              </tr>
              <tr id="q15">
                <td>15.</td>
                <td>examples of ways that a person's facial expression can affect someone else's actions.</td>
                <td>
                  <select id="P2_FI_15">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option>
                  </select>
                </td>
              </tr>
              <tr id="q16">
                <td>16.</td>
                <td>a reference to reasons for hiding emotions.</td>
                <td>
                  <select id="P2_FI_16">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option>
                  </select>
                </td>
              </tr>
              <tr id="q17">
                <td>17.</td>
                <td>examples of times when facial expressions are used especially frequently.</td>
                <td>
                  <select id="P2_FI_17">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option>
                  </select>
                </td>
              </tr>
              <tr id="q18">
                <td>18.</td>
                <td>examples of changes inside the body when an emotion is felt.</td>
                <td>
                  <select id="P2_FI_18">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option>
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3 style="margin-top:16px">Questions 19‚Äì23</h3>
        <p>Match each statement with the correct researcher, <strong>A‚ÄìE</strong>.</p>

        <div class="qblock">
          <p><strong>List of Researchers</strong></p>
          <ul>
            <li><strong>A</strong> Paul Ekman</li>
            <li><strong>B</strong> Alan Fridlund</li>
            <li><strong>C</strong> James Russell</li>
            <li><strong>D</strong> Linda Camras</li>
            <li><strong>E</strong> Joseph Campos</li>
          </ul>

          <table class="match-table" aria-label="Match statements to researchers">
            <thead><tr><th>Q</th><th>Statement</th><th>Answer (A‚ÄìE)</th></tr></thead>
            <tbody>
              <tr id="q19">
                <td>19.</td>
                <td>Focusing on the face in researching emotions is like studying a large structure by looking at just one small unit of it.</td>
                <td>
                  <select id="P2_RS_19">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
                  </select>
                </td>
              </tr>
              <tr id="q20">
                <td>20.</td>
                <td>Facial expressions developed in order to encourage other people to react in particular ways.</td>
                <td>
                  <select id="P2_RS_20">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
                  </select>
                </td>
              </tr>
              <tr id="q21">
                <td>21.</td>
                <td>Although certain researchers have different opinions about various points, they share some important ideas.</td>
                <td>
                  <select id="P2_RS_21">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
                  </select>
                </td>
              </tr>
              <tr id="q22">
                <td>22.</td>
                <td>Both emotion and expression can exist independently of each other in certain circumstances.</td>
                <td>
                  <select id="P2_RS_22">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
                  </select>
                </td>
              </tr>
              <tr id="q23">
                <td>23.</td>
                <td>It cannot be proved that there is a connection between facial expression and real emotion.</td>
                <td>
                  <select id="P2_RS_23">
                    <option value="">‚Äî</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3 style="margin-top:16px">Questions 24‚Äì26</h3>
        <p>Complete the sentences below. <strong>Choose ONE WORD ONLY</strong> from the passage for each answer.</p>

        <!-- Inline answers inside each sentence -->
        <div class="qblock inline-q" id="q24">
          <p>
            <label for="P2_SC_24">
              <strong>24.</strong> In Fridlund‚Äôs view, a
              <input type="text" id="P2_SC_24" class="inline-input" placeholder="one word"
                     autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              on someone‚Äôs face may be intended as an invitation to come nearer.
            </label>
          </p>
        </div>

        <div class="qblock inline-q" id="q25">
          <p>
            <label for="P2_SC_25">
              <strong>25.</strong> According to Fridlund, when we are by ourselves we still use facial expressions because we are having a
              <input type="text" id="P2_SC_25" class="inline-input" placeholder="one word"
                     autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              with someone in our minds.
            </label>
          </p>
        </div>

        <div class="qblock inline-q" id="q26">
          <p>
            <label for="P2_SC_26">
              <strong>26.</strong> Fridlund considers facial expressions to be
              <input type="text" id="P2_SC_26" class="inline-input" placeholder="one word"
                     autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
              other people that can affect our contact with them.
            </label>
          </p>
        </div>

        <footer class="nav">
          <a class="btn ghost" href="readingp1.html">Passage 1</a>
          <a class="btn active" href="readingp2.html" aria-current="page">Passage 2</a>
          <a class="btn ghost" href="readingp3.html">Passage 3</a>
        </footer>
      </aside>
    </div>
  </div>
</main>

<script>
  /* ---------- GLOBAL: collect & persist all Reading P2 answers ---------- */
  function collectAndSaveAnswersP2(){
    const answers = {};
    document.querySelectorAll('input[type=radio]:checked').forEach(el=>{ answers[el.name] = el.value; });
    document.querySelectorAll('select').forEach(el=>{ answers[el.id || el.name || `sel_${Math.random().toString(36).slice(2)}`] = el.value; });
    document.querySelectorAll('input[type=text], textarea').forEach(el=>{ answers[el.id || el.name || `txt_${Math.random().toString(36).slice(2)}`] = el.value; });

    localStorage.setItem('sp_reading_answers', JSON.stringify(answers));
    localStorage.setItem('sp_reading_submitted_at', new Date().toISOString());

    const reading = JSON.parse(localStorage.getItem('reading') || '{}');
    Object.entries(answers).forEach(([k,v])=>{ if (k && k.startsWith('P2_')) reading[k] = v; });

    // Map to Q14‚ÄìQ26 keys
    const map = {
      Q14:'P2_FI_14', Q15:'P2_FI_15', Q16:'P2_FI_16', Q17:'P2_FI_17', Q18:'P2_FI_18',
      Q19:'P2_RS_19', Q20:'P2_RS_20', Q21:'P2_RS_21', Q22:'P2_RS_22', Q23:'P2_RS_23',
      Q24:'P2_SC_24', Q25:'P2_SC_25', Q26:'P2_SC_26'
    };
    for (const [qKey, srcKey] of Object.entries(map)){
      reading[qKey] = answers[srcKey] || '';
    }
    localStorage.setItem('reading', JSON.stringify(reading));
  }
</script>

<script>
// Dark mode toggle (shared)
const themeToggle=document.getElementById('themeToggle');
if(themeToggle){
  const saved=localStorage.getItem('sp_theme')||'light';
  document.documentElement.setAttribute('data-theme', saved);
  themeToggle.checked = saved==='dark';
  themeToggle.addEventListener('change',()=>{
    const mode=themeToggle.checked?'dark':'light';
    document.documentElement.setAttribute('data-theme', mode);
    localStorage.setItem('sp_theme', mode);
  });
}

// Highlighter (yellow/green + eraser)
function wrapSelection(color){
  const sel=window.getSelection();
  if(!sel || sel.isCollapsed) return;
  const range=sel.getRangeAt(0);
  const span=document.createElement('span');
  span.className = 'hl ' + (color==='yellow' ? 'hl-yellow' : 'hl-green');
  try{range.surroundContents(span);}catch{}
  sel.removeAllRanges();
}
function eraseSelection(){
  const sel=window.getSelection();
  if(!sel || sel.isCollapsed) return;
  const range=sel.getRangeAt(0);
  document.querySelectorAll('#passage span.hl').forEach(el=>{
    try{
      if(range.intersectsNode(el)){
        const parent=el.parentNode;
        while(el.firstChild) parent.insertBefore(el.firstChild, el);
        parent.removeChild(el);
        parent.normalize();
      }
    }catch{}
  });
  sel.removeAllRanges();
}
document.querySelectorAll('[data-hl]').forEach(b=>b.addEventListener('click',()=>wrapSelection(b.getAttribute('data-hl'))));
document.getElementById('hl-eraser')?.addEventListener('click', eraseSelection);

// Autosave: text, radios, selects (prefix P2_) + disable browser suggestions
(function persistAll(){
  document.querySelectorAll('input[type=text], textarea').forEach(el=>{
    el.setAttribute('autocomplete','off');
    el.setAttribute('autocorrect','off');
    el.setAttribute('autocapitalize','off');
    el.setAttribute('spellcheck','false');

    const key='P2_'+(el.id||el.name||'txt_'+Math.random().toString(36).slice(2));
    if(!el.dataset.key){ el.dataset.key = key; }
    el.value = localStorage.getItem(el.dataset.key) || '';
    el.addEventListener('input',()=>{ localStorage.setItem(el.dataset.key, el.value); collectAndSaveAnswersP2(); });
  });
  document.querySelectorAll('input[type=radio]').forEach(el=>{
    const key='P2_'+(el.name||el.id||'radio');
    if(localStorage.getItem(key)===el.value) el.checked=true;
    el.addEventListener('change',()=>{ if(el.checked) localStorage.setItem(key, el.value); collectAndSaveAnswersP2(); });
  });
  document.querySelectorAll('select').forEach(el=>{
    const key='P2_'+(el.id||el.name||'sel');
    const saved=localStorage.getItem(key);
    if(saved!==null) el.value=saved;
    el.addEventListener('change',()=>{ localStorage.setItem(key, el.value); collectAndSaveAnswersP2(); });
  });
  collectAndSaveAnswersP2();
})();

// Question nav: smooth jump & active ring
(function(){
  const qnav=document.getElementById('qnav');
  const aside=document.getElementById('questions');
  if(!qnav||!aside) return;
  qnav.addEventListener('click', (e)=>{
    const btn=e.target.closest('button[data-q]'); if(!btn) return;
    const target=document.getElementById(btn.dataset.q);
    if(target){ aside.scrollTo({top: target.offsetTop - 8, behavior:'smooth'}); }
    qnav.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  });
})();

// Mark question boxes green when their answers are filled
(function(){
  const map={
    q14:'#P2_FI_14', q15:'#P2_FI_15', q16:'#P2_FI_16', q17:'#P2_FI_17', q18:'#P2_FI_18',
    q19:'#P2_RS_19', q20:'#P2_RS_20', q21:'#P2_RS_21', q22:'#P2_RS_22', q23:'#P2_RS_23',
    q24:'#P2_SC_24', q25:'#P2_SC_25', q26:'#P2_SC_26'
  };
  const qnav=document.getElementById('qnav');
  if(!qnav) return;

  function btnFor(id){ return qnav.querySelector(`button[data-q="${id}"]`); }
  function isAnswered(sel){
    const el=document.querySelector(sel);
    if(!el) return false;
    if(el.tagName==='SELECT') return el.value!=='';
    return (el.value||'').trim().length>0;
  }
  function update(id, pulse){
    const sel=map[id]; if(!sel) return;
    const btn=btnFor(id); if(!btn) return;
    const done=isAnswered(sel);
    if(done){
      const first=!btn.classList.contains('done');
      btn.classList.add('done');
      if(pulse && first){ btn.classList.add('pulse'); setTimeout(()=>btn.classList.remove('pulse'),600); }
    }else{
      btn.classList.remove('done');
    }
    collectAndSaveAnswersP2();
  }

  Object.entries(map).forEach(([qid, sel])=>{
    const el=document.querySelector(sel);
    if(!el) return;
    const evt = (el.tagName==='SELECT') ? 'change' : 'input';
    el.addEventListener(evt, ()=>update(qid,true));
  });
  setTimeout(()=>{ Object.keys(map).forEach(id=>update(id,false)); }, 0);
})();
</script>

<script>
// Ensure timer badge exists in header
(function ensureTimerBadge(){
  if(!document.getElementById('timer')){
    const badge=document.createElement('span');
    badge.id='timer';
    badge.className='timer';
    badge.textContent='60:00';
    const header=document.querySelector('.appbar');
    const meta=document.querySelector('.appbar .meta');
    if(header) header.insertBefore(badge, meta || null);
  }
})();
</script>

<script>
// Footer nav should actually navigate
(function(){
  document.querySelectorAll('footer.nav a').forEach(a=>{
    a.addEventListener('click', (e)=>{ e.preventDefault(); window.location.href = a.getAttribute('href'); });
  });
})();
</script>

<script>
// ===== Reading global 60-minute countdown (persists across passages) =====
(function readingCountdown(){
  const DURATION_MS = 60 * 60 * 1000;
  const END_KEY = 'sp_reading_end_ts';
  const DONE_KEY = 'sp_reading_done';
  const timerEl = document.getElementById('timer');

  let end = parseInt(localStorage.getItem(END_KEY)||'0', 10);
  const now = Date.now();
  if (!end || end < now) {
    end = now + DURATION_MS;
    localStorage.setItem(END_KEY, String(end));
    localStorage.removeItem(DONE_KEY);
  }

  function fmt(n){ return String(n).padStart(2,'0'); }
  function tick(){
    if (localStorage.getItem(DONE_KEY)==='1') { timeUp(true); return; }
    const remain = parseInt(localStorage.getItem(END_KEY)||String(end),10) - Date.now();
    if (remain <= 0){ if (timerEl) timerEl.textContent = '00:00'; timeUp(false); return; }
    const totalSec = Math.floor(remain/1000);
    const m = Math.floor(totalSec/60);
    const s = totalSec % 60;
    if (timerEl) timerEl.textContent = `${fmt(m)}:${fmt(s)}`;
    setTimeout(tick, 250);
  }

  function timeUp(fromOtherTab){
    if (localStorage.getItem(DONE_KEY)==='1') { window.location.href = 'writing.html'; return; }
    try{
      document.querySelectorAll('input, select, textarea, button').forEach(el=>{ if (el.id !== 'themeToggle') el.disabled = true; });
    }catch{}
    collectAndSaveAnswersP2();
    localStorage.setItem(DONE_KEY, '1');
    setTimeout(()=>{ window.location.href = 'writing.html'; }, fromOtherTab ? 0 : 300);
  }

  window.addEventListener('beforeunload', collectAndSaveAnswersP2);
  tick();
})();
</script>
</body>
</html>
