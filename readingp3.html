<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sevenplus ‚Äî Reading (Passage 3)</title>
<link rel="icon" href="./favicon/favicon-180.png" sizes="32x32">
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<meta name="theme-color" content="#1aa2c9">
<style>
  :root{--brand-blue:#1aa2c9;--brand-gray:#55595c;--bg:#f7f9fb;--panel:#fff;--text:#1b1f23;--line:#e5e8eb}
  [data-theme="dark"]{--bg:#0e1116;--panel:#141922;--text:#e6edf3;--line:#2a2f38}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto}
  .appbar{position:sticky;top:0;background:var(--panel);border-bottom:1px solid var(--line);display:flex;gap:12px;align-items:center;padding:10px 16px;z-index:10}
  .logo-text{font-size:1.2rem;text-decoration:none}
  .meta{margin-left:auto;display:flex;gap:10px;align-items:center}
  .btn{border:1px solid var(--line);background:var(--panel);padding:.55rem .9rem;border-radius:10px;cursor:pointer}
  .btn.primary{background:var(--brand-blue);color:#fff;border-color:var(--brand-blue)}
  .btn.ghost{background:transparent}
  .btn.active{background:var(--brand-blue);color:#fff;border-color:var(--brand-blue);pointer-events:none}
  main{max-width:1200px;margin:16px auto;padding:0 16px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
  .toolbar{display:flex;gap:8px;align-items:center;border:1px dashed var(--line);padding:8px;border-radius:10px;margin:10px 0}
  .swatch{width:20px;height:20px;border-radius:4px;border:1px solid var(--line);cursor:pointer}
  .swatch.yellow{background:#fff59d}
  .swatch.green{background:#c8e6c9}
  .swatch.eraser{display:flex;align-items:center;justify-content:center;font-size:14px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .panel{min-height:60vh;max-height:calc(100vh - 150px);overflow:auto;border:1px solid var(--line);border-radius:12px;padding:16px;background:var(--panel)}
  h1,h2,h3{margin:.2rem 0}
  .note{color:#667085}
  .qblock{border:1px solid var(--line);border-radius:12px;padding:12px;margin:10px 0}
  .qblock.correct{border-color:inherit;animation:none}
  .options{display:grid;gap:6px;margin-top:8px}
  input[type=text]{width:100%;padding:.5rem .6rem;border:1px solid var(--line);border-radius:10px}
  footer.nav{display:flex;gap:8px;justify-content:center;margin:14px 0}
  footer.nav a{ text-decoration:none }
  .timer{margin-left:8px;padding:.25rem .55rem;border:1px solid var(--line);border-radius:10px;background:var(--panel);font-weight:600;color:var(--brand-blue);min-width:64px;text-align:center}

  .hl{display:inline;padding:0;border:0;line-height:inherit;font:inherit}
  .hl-yellow{background-color:#fff59d}
  .hl-green{background-color:#c8e6c9}

  .qnav{display:flex;gap:6px;flex-wrap:wrap;margin:12px 0}
  .qnav button{width:34px;height:34px;border:1px solid var(--line);border-radius:6px;background:#fff;cursor:pointer}
  .qnav button.done{background:#1fb66a;color:#fff;font-weight:600;border-color:#1fb66a}
  .qnav button.active{outline:2px solid var(--brand-blue)}
  @keyframes pulseGreen{0%{box-shadow:0 0 0 0 rgba(31,182,106,.6)}70%{box-shadow:0 0 0 10px rgba(31,182,106,0)}100%{box-shadow:none}}
  .qnav button.pulse{animation:pulseGreen .6s ease-out 1;border-color:#1fb66a}
  [data-theme="dark"] .qnav button{background:var(--panel)}

  .bank{display:flex;flex-wrap:wrap;gap:8px;padding:8px;border:1px dashed var(--line);border-radius:10px;margin:6px 0;background:var(--panel)}
  .chip{user-select:none;cursor:grab;display:inline-flex;align-items:center;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff}
  [data-theme="dark"] .chip{background:var(--panel)}
  .drop{display:inline-flex;min-width:160px;min-height:34px;align-items:center;justify-content:center;padding:4px 8px;border:2px dashed var(--line);border-radius:8px;margin:0 4px}
  .drop.filled{border-style:solid}
  .drop.dd-correct{border-color:#1fb66a;animation:pulseGreen .6s ease-out 1}
</style>
</head>
<body>
<header class="appbar">
  <span class="logo-text"><strong style="color:var(--brand-blue)">seven</strong><strong style="color:var(--brand-gray)">plus</strong></span>
  <span id="timer" class="timer" aria-live="polite">60:00</span>
  <div class="meta">
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
      <input id="themeToggle" type="checkbox" />
      <span>üåì</span>
    </label>
  </div>
</header>

<main>
  <div class="card">
    <div class="toolbar"><span>Highlighter:</span>
      <button class="swatch yellow" data-hl="yellow" title="Yellow"></button>
      <button class="swatch green" data-hl="green" title="Green"></button>
      <button class="swatch eraser" id="hl-eraser" title="Eraser">üßΩ</button>
    </div>

    <div class="grid">
      <!-- LEFT: PASSAGE -->
      <article id="passage" class="panel" tabindex="0">
        <h2>READING PASSAGE 3</h2>
        <p class="note">You should spend about 20 minutes on Questions 27‚Äì40 which are based on Reading Passage 3.</p>

        <h2 style="text-align:center">Why good food tastes good?</h2>

        <p><strong>A</strong> Barb Stuckey, who describes herself as a professional food developer (though she once worked as a restaurant inspector), has just released the latest in a recent spate of books on the multisensory perception of flavor. This new volume, though, is certainly targeted at a somewhat different audience from the others. It is part memoir, detailing the author‚Äôs many years working in a major North American company focused on developing novel food and beverage products, and part self-help book, offering advice on how we could all improve our ability to taste (mindful eating plays a big role here). In his book, Stevenson provided the most comprehensive academic summary of research into how the senses interact to give rise to the emergent property that is flavor. By contrast, Prescott‚Äôs contribution tackled the question of why it is that we like what we like when it comes to food and drink, dealing with the differing roles of the senses in establishing and maintaining such preferences and, importantly, dislikes.</p>

        <p><strong>B</strong> The author sets out her position at the start: as someone who had avoided science classes in school, she longed to read a straightforward book for a layperson that could teach her how to taste food without first having to learn medical science. There wasn‚Äôt one, so she decided to write this one. Consistent with that objective, complex terms that might prove difficult for a lay audience, such as orthonasal and retronasal olfaction, are simplified as ‚Äúnose-smelling‚Äù and ‚Äúmouth-smelling,‚Äù respectively.</p>

        <p><strong>C</strong> Like the famous North American food critic Jeffrey Steingarten, when he tested her in the lab here in Oxford some years ago, Barb objects to the label ‚Äúsupertaster.‚Äù Coined by Linda Bartoshuk, it describes individuals (about a quarter to a third of the population) who exhibit increased sensitivity to certain especially bitter tastants such as PROP (6-n-propylthiouracil) as well as to oral-somatosensory textural cues. Stuckey suggests replacing the pejorative ‚Äúnon-taster‚Äù and ‚Äúsupertaster‚Äù with ‚Äútolerant taster‚Äù and ‚Äúhypertaster,‚Äù respectively. Barb and Roger are both hypertasters.</p>

        <p><strong>D</strong> Stuckey has spoken to the right people for her book. There are many quotes from interviews with international figures in flavor research: Paul Breslin (salt perception), Barry Green (trigeminal stimulation in food and drink), and Linda Bartoshuk (supertasters) among others. She also extends what academics cautiously say in print. For example, she quotes Breslin: ‚ÄúThere might be around twenty qualities of taste but I am most comfortable saying that there‚Äôs five.‚Äù Stuckey goes further, proposing that there may be as many as 25 different basic tastes‚Äîif by ‚Äúbasic‚Äù we mean any taste for which we have a receptor on our tongue. While most researchers would be happy with sweet, sour, salty, bitter, and umami, it is interesting to consider that there may be others for which receptor sensitivity on the tongue has not yet been demonstrated.</p>

        <p><strong>E</strong> Stuckey includes a number of case studies, reminding me of Lawrence Rosenblum‚Äôs volume on the senses <em>See what I‚Äôm saying</em>. She writes, for example, about Carlo Middione, an Italian chef in San Francisco who lost his sense of taste (rather than smell) after a car accident. There are also sections on the preparation and consumption of food and drink by those who have lost one of their senses (e.g., vision or hearing). And when she finds gaps in the research‚Äîsuch as how the deaf experience flavor perception‚Äîshe goes and collects relevant data herself.</p>

        <p><strong>F</strong> The book is strongest in industry examples from her work with Mattson, a large North American food product development company. Many cases hinge on finding just the right balance of the basic tastes, and the right mouth-feel, for a particular food or beverage. One of the major themes is the importance of food texture and the temporal dynamics of changes in mouthfeel as we eat and drink, which matter to many products and brands we buy regularly. Texture is tricky to study academically; often it‚Äôs easier to change color or aroma. Yet in many cases texture attributes are crucial to a product‚Äôs success among consumers‚Äîfor example, the development of low-calorie cola drinks that Stuckey‚Ä¶</p>

        <p><strong>G</strong> Where Stuckey seems on weaker ground is the neuroscience of tasting. In the short section on ‚ÄúThe expert eater brain‚Äù she asserts that ‚ÄúNot only do tasting experts use more areas of the brain, they can enjoy the processing better than novices.‚Äù While the second part may be true, the first statement does not do justice to the complexity of the published data.</p>

        <p><strong>H</strong> Although Heston Blumenthal recommends the book on the back cover, most of the other endorsements come from people in the food industry‚Äîchefs and those in cookery schools. Ultimately, this volume will likely receive a warmer reception among ‚Äúpassionate eaters‚Äù and people working in the food industry than among academic researchers in flavor perception.</p>

        <div class="qnav" id="qnav">
          <button data-q="q27">27</button><button data-q="q28">28</button><button data-q="q29">29</button><button data-q="q30">30</button><button data-q="q31">31</button><button data-q="q32">32</button><button data-q="q33">33</button><button data-q="q34">34</button><button data-q="q35">35</button><button data-q="q36">36</button><button data-q="q37">37</button><button data-q="q38">38</button><button data-q="q39">39</button><button data-q="q40">40</button>
        </div>
      </article>

      <!-- RIGHT: QUESTIONS -->
      <aside id="questions" class="panel" tabindex="0">
        <h3>Questions 27‚Äì31</h3>
        <p>Choose the correct letter A, B, C or D.</p>

        <div class="qblock" id="q27">
          <p><strong>27.</strong> What was the author‚Äôs main reason for writing the book?</p>
          <div class="options">
            <label><input type="radio" name="P3_Q27" value="A"> She wanted to create a scientific textbook on food tasting.</label>
            <label><input type="radio" name="P3_Q27" value="B"> She felt there were no simple books on food tasting for non-experts.</label>
            <label><input type="radio" name="P3_Q27" value="C"> She wanted to provide an in-depth analysis of olfactory science.</label>
            <label><input type="radio" name="P3_Q27" value="D"> She was inspired by the complexity of the terms in food science.</label>
          </div>
        </div>

        <div class="qblock" id="q28">
          <p><strong>28.</strong> According to Stuckey, what is the basis for determining the number of basic tastes?</p>
          <div class="options">
            <label><input type="radio" name="P3_Q28" value="A"> The substances that activate receptors on the tongue.</label>
            <label><input type="radio" name="P3_Q28" value="B"> The agreement among researchers on basic tastes.</label>
            <label><input type="radio" name="P3_Q28" value="C"> The types of food tasted through receptors.</label>
            <label><input type="radio" name="P3_Q28" value="D"> The scientific consensus on five tastes.</label>
          </div>
        </div>

        <div class="qblock" id="q29">
          <p><strong>29.</strong> When Stuckey discovers a lack of research about flavor perception in disabled people, she ‚Ä¶</p>
          <div class="options">
            <label><input type="radio" name="P3_Q29" value="A"> cites existing studies in her book.</label>
            <label><input type="radio" name="P3_Q29" value="B"> interviews people who are deaf.</label>
            <label><input type="radio" name="P3_Q29" value="C"> decides to focus on other aspects of sensory perception.</label>
            <label><input type="radio" name="P3_Q29" value="D"> conducts her own research.</label>
          </div>
        </div>

        <div class="qblock" id="q30">
          <p><strong>30.</strong> What can be inferred from paragraph F?</p>
          <div class="options">
            <label><input type="radio" name="P3_Q30" value="A"> Texture is less important than flavor.</label>
            <label><input type="radio" name="P3_Q30" value="B"> Changing color is easier than altering texture.</label>
            <label><input type="radio" name="P3_Q30" value="C"> Balance of taste and texture is key for success.</label>
            <label><input type="radio" name="P3_Q30" value="D"> Tactile attributes are irrelevant to success.</label>
          </div>
        </div>

        <div class="qblock" id="q31">
          <p><strong>31.</strong> The author suggests Stuckey‚Äôs book is likely to be more appreciated by</p>
          <div class="options">
            <label><input type="radio" name="P3_Q31" value="A"> academic researchers focused on flavor perception.</label>
            <label><input type="radio" name="P3_Q31" value="B"> professionals working in the food industry.</label>
            <label><input type="radio" name="P3_Q31" value="C"> people with an academic interest in cookery schools.</label>
            <label><input type="radio" name="P3_Q31" value="D"> scholars studying the science of taste.</label>
          </div>
        </div>

        <h3 style="margin-top:16px">Questions 32‚Äì35</h3>
        <p>YES if the statement agrees with the writer ‚Äî NO if it contradicts ‚Äî NOT GIVEN if it is impossible to say.</p>

        <div class="qblock" id="q32">
          <p><strong>32.</strong> Stuckey‚Äôs book was written for a distinct group of readers by chance.</p>
          <div class="options">
            <label><input type="radio" name="P3_Q32" value="YES"> YES</label>
            <label><input type="radio" name="P3_Q32" value="NO"> NO</label>
            <label><input type="radio" name="P3_Q32" value="NOT GIVEN"> NOT GIVEN</label>
          </div>
        </div>

        <div class="qblock" id="q33">
          <p><strong>33.</strong> With the intention of simplifying the language of food science, Stuckey created a book.</p>
          <div class="options">
            <label><input type="radio" name="P3_Q33" value="YES"> YES</label>
            <label><input type="radio" name="P3_Q33" value="NO"> NO</label>
            <label><input type="radio" name="P3_Q33" value="NOT GIVEN"> NOT GIVEN</label>
          </div>
        </div>

        <div class="qblock" id="q34">
          <p><strong>34.</strong> Before writing her book, Stuckey consulted experts.</p>
          <div class="options">
            <label><input type="radio" name="P3_Q34" value="YES"> YES</label>
            <label><input type="radio" name="P3_Q34" value="NO"> NO</label>
            <label><input type="radio" name="P3_Q34" value="NOT GIVEN"> NOT GIVEN</label>
          </div>
        </div>

        <div class="qblock" id="q35">
          <p><strong>35.</strong> The author agrees with the idea of ‚Äúthe expert eater brain‚Äù regarding more active functioning.</p>
          <div class="options">
            <label><input type="radio" name="P3_Q35" value="YES"> YES</label>
            <label><input type="radio" name="P3_Q35" value="NO"> NO</label>
            <label><input type="radio" name="P3_Q35" value="NOT GIVEN"> NOT GIVEN</label>
          </div>
        </div>

        <h3 style="margin-top:16px">Questions 36‚Äì40</h3>
        <p>Complete each sentence with the correct ending, A‚ÄìH. (Drag a chip into each blank.)</p>

        <div class="bank" id="bank">
          <span class="chip" draggable="true" data-key="A">A. offers practical advice on enhancing tasting ability.</span>
          <span class="chip" draggable="true" data-key="B">B. describes people with high sensitivity to taste textures.</span>
          <span class="chip" draggable="true" data-key="C">C. highlights texture and mouthfeel's role in food success.</span>
          <span class="chip" draggable="true" data-key="D">D. explores multisensory food perception in detail.</span>
          <span class="chip" draggable="true" data-key="E">E. challenges views and suggests new basic tastes.</span>
          <span class="chip" draggable="true" data-key="F">F. relies on expert interviews, not case studies.</span>
          <span class="chip" draggable="true" data-key="G">G. emphasizes understanding science before food learning.</span>
          <span class="chip" draggable="true" data-key="H">H. includes real-life scenarios.</span>
        </div>

        <div class="qblock" id="q36to40">
          <p>
            36. The author‚Äôs new self-help book
            <span class="drop" id="drop36" data-label="36" data-answer="A">36</span>
          </p>
          <p>
            37. In comparison to Stevenson‚Äôs book, Stuckey‚Äôs book
            <span class="drop" id="drop37" data-label="37" data-answer="G">37</span>
          </p>
          <p>
            38. Barb Stuckey disagrees with the term ‚Äòsupertaster‚Äô which
            <span class="drop" id="drop38" data-label="38" data-answer="B">38</span>
          </p>
          <p>
            39. In resemblance to Lawrence Rosenblum‚Äôs style, Barb‚Äôs book
            <span class="drop" id="drop39" data-label="39" data-answer="H">39</span>
          </p>
          <p>
            40. The focus of Stuckey‚Äôs book on beverage development
            <span class="drop" id="drop40" data-label="40" data-answer="C">40</span>
          </p>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
            <button class="btn" id="resetDD">Reset</button>
          </div>
        </div>

        <footer class="nav">
          <a class="btn ghost" href="readingp1.html">Passage 1</a>
          <a class="btn ghost" href="readingp2.html">Passage 2</a>
          <a class="btn active" href="readingp3.html" aria-current="page">Passage 3</a>
        </footer>
        <button class="btn primary" id="proceedBtn">Proceed to Writing</button>
      </aside>
    </div>
  </div>
</main>

<script>
/* ===== Theme toggle ===== */
(function(){
  const toggle=document.getElementById('themeToggle');
  if(!toggle) return;
  const saved=localStorage.getItem('sp_theme')||'light';
  document.documentElement.setAttribute('data-theme', saved);
  toggle.checked=(saved==='dark');
  toggle.addEventListener('change',()=>{
    const mode=toggle.checked?'dark':'light';
    document.documentElement.setAttribute('data-theme', mode);
    localStorage.setItem('sp_theme', mode);
  });
})();

/* ===== Highlighter ===== */
(function(){
  function wrap(color){
    const sel=window.getSelection();
    if(!sel || sel.isCollapsed) return;
    const range=sel.getRangeAt(0);
    const span=document.createElement('span');
    span.className='hl '+(color==='yellow'?'hl-yellow':'hl-green');
    try{ range.surroundContents(span); }catch{}
    sel.removeAllRanges();
  }
  function erase(){
    const sel=window.getSelection();
    if(!sel || sel.isCollapsed) return;
    const range=sel.getRangeAt(0);
    document.querySelectorAll('#passage span.hl').forEach(el=>{
      try{
        if(range.intersectsNode(el)){
          const p=el.parentNode;
          while(el.firstChild) p.insertBefore(el.firstChild, el);
          p.removeChild(el); p.normalize();
        }
      }catch{}
    });
    sel.removeAllRanges();
  }
  document.querySelectorAll('[data-hl]').forEach(b=>b.addEventListener('click',()=>wrap(b.dataset.hl)));
  const er=document.getElementById('hl-eraser'); if(er) er.addEventListener('click', erase);
})();

/* ===== GLOBAL: collect & snapshot ALL answers into localStorage ===== */
(function(){
  function collectAll(){
    const a={};
    document.querySelectorAll('input[type=radio]:checked').forEach(el=>{ a[el.name]=el.value; });
    document.querySelectorAll('select').forEach(el=>{ a[el.id||el.name||`sel_${Math.random().toString(36).slice(2)}`]=el.value; });
    document.querySelectorAll('input[type=text], textarea').forEach(el=>{ a[el.id||el.name||`txt_${Math.random().toString(36).slice(2)}`]=el.value; });
    ['drop36','drop37','drop38','drop39','drop40'].forEach(id=>{ const chip=document.querySelector('#'+id+' .chip'); a[id]=chip?chip.dataset.key:''; });
    a.__page='reading_p3';
    const iso=new Date().toISOString();
    localStorage.setItem('sp_reading_answers', JSON.stringify(a));
    localStorage.setItem('sp_reading_saved_at', iso);
    const pageBundle={
      page:'reading_p3',
      savedAt: iso,
      answers:{
        P3_Q27:a['P3_Q27']||'', P3_Q28:a['P3_Q28']||'', P3_Q29:a['P3_Q29']||'', P3_Q30:a['P3_Q30']||'',
        P3_Q31:a['P3_Q31']||'', P3_Q32:a['P3_Q32']||'', P3_Q33:a['P3_Q33']||'', P3_Q34:a['P3_Q34']||'', P3_Q35:a['P3_Q35']||'',
        drop36:a['drop36']||'', drop37:a['drop37']||'', drop38:a['drop38']||'', drop39:a['drop39']||'', drop40:a['drop40']||''
      }
    };
    localStorage.setItem('sp_reading_p3', JSON.stringify(pageBundle));
  }
  window.__sp_collectReadingAnswers = collectAll;
  const snapshot=()=>{ try{ collectAll(); }catch{} };
  window.addEventListener('visibilitychange',()=>{ if(document.visibilityState==='hidden') snapshot(); });
  window.addEventListener('pagehide', snapshot);
  window.addEventListener('beforeunload', snapshot);
  document.addEventListener('change', snapshot, true);
})();

/* ===== Persist per-field (P3_*) ===== */
(function(){
  const keyFor=(raw)=> raw && raw.startsWith('P3_') ? raw : ('P3_'+(raw||''));
  document.querySelectorAll('input[type=text], textarea').forEach(el=>{
    const key=keyFor(el.id||el.name||('txt_'+Math.random().toString(36).slice(2)));
    if(!el.dataset.key) el.dataset.key=key;
    el.value = localStorage.getItem(key) || '';
    el.addEventListener('input',()=>{ localStorage.setItem(key, el.value); window.__sp_collectReadingAnswers?.(); });
  });
  document.querySelectorAll('input[type=radio]').forEach(el=>{
    const key=keyFor(el.name||el.id||'radio');
    const saved=localStorage.getItem(key);
    if(saved===el.value) el.checked=true;
    el.addEventListener('change',()=>{ if(el.checked){ localStorage.setItem(key, el.value); window.__sp_collectReadingAnswers?.(); } });
  });
  document.querySelectorAll('select').forEach(el=>{
    const key=keyFor(el.id||el.name||'sel');
    const saved=localStorage.getItem(key);
    if(saved!==null) el.value=saved;
    el.addEventListener('change',()=>{ localStorage.setItem(key, el.value); window.__sp_collectReadingAnswers?.(); });
  });
})();

/* ===== Question nav ===== */
(function(){
  const qnav=document.getElementById('qnav');
  const pane=document.getElementById('questions');
  if(!qnav||!pane) return;
  qnav.addEventListener('click',e=>{
    const btn=e.target.closest('button[data-q]'); if(!btn) return;
    const target=document.getElementById(btn.dataset.q);
    if(target){ pane.scrollTo({top: target.offsetTop-8, behavior:'smooth'}); }
    qnav.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  });
})();
function pulseBox(qid){
  const btn=document.querySelector(`.qnav button[data-q="${qid}"]`);
  if(!btn) return; btn.classList.add('pulse'); setTimeout(()=>btn.classList.remove('pulse'),650);
}

/* ===== Done markers for radio questions ===== */
(function(){
  const map={
    q27:'input[name="P3_Q27"]', q28:'input[name="P3_Q28"]', q29:'input[name="P3_Q29"]', q30:'input[name="P3_Q30"]',
    q31:'input[name="P3_Q31"]', q32:'input[name="P3_Q32"]', q33:'input[name="P3_Q33"]', q34:'input[name="P3_Q34"]', q35:'input[name="P3_Q35"]'
  };
  const qnav=document.getElementById('qnav'); if(!qnav) return;
  const btnFor=id=>qnav.querySelector(`button[data-q="${id}"]`);
  function update(id){
    const btn=btnFor(id); if(!btn) return;
    const sel=map[id]; const done=!!document.querySelector(sel+':checked');
    btn.classList.toggle('done', done);
  }
  Object.entries(map).forEach(([qid, sel])=>{
    document.querySelectorAll(sel).forEach(r=>{
      r.addEventListener('change',()=>{ update(qid); window.__sp_collectReadingAnswers?.(); });
    });
  });
  setTimeout(()=>Object.keys(map).forEach(update),0);
})();

/* ===== Drag & Drop for 36‚Äì40 ===== */
(function(){
  const bank=document.getElementById('bank');
  const drops=[36,37,38,39,40].map(n=>document.getElementById('drop'+n));
  const LS='P3_DD_';
  function chipByKey(key){ return bank.querySelector(`.chip[data-key="${key}"]`) || document.querySelector(`.chip[data-key="${key}"]`); }
  function wire(chip){
    chip.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain', chip.dataset.key); e.dataTransfer.effectAllowed='move'; chip.classList.add('dragging'); });
    chip.addEventListener('dragend',()=>chip.classList.remove('dragging'));
  }
  bank.querySelectorAll('.chip').forEach(wire);
  function markDone(qid,on){ const b=document.querySelector(`.qnav button[data-q="${qid}"]`); if(b) b.classList.toggle('done',!!on); }
  function fill(dz,key){
    const existing=dz.querySelector('.chip'); if(existing) bank.appendChild(existing);
    const chip=chipByKey(key); if(!chip) return;
    dz.textContent=''; dz.appendChild(chip); dz.classList.add('filled');
    const ok=(dz.dataset.answer===key); dz.classList.toggle('dd-correct', ok); if(ok) pulseBox(dz.id.replace('drop','q'));
    localStorage.setItem(LS+dz.id, key); markDone(dz.id.replace('drop','q'), true); window.__sp_collectReadingAnswers?.();
  }
  function clear(dz){
    const c=dz.querySelector('.chip'); if(c) bank.appendChild(c);
    dz.classList.remove('filled','dd-correct'); dz.textContent=dz.dataset.label;
    localStorage.removeItem(LS+dz.id); markDone(dz.id.replace('drop','q'), false); window.__sp_collectReadingAnswers?.();
  }
  drops.forEach(dz=>{
    dz.addEventListener('dragover',e=>e.preventDefault());
    dz.addEventListener('drop',e=>{ e.preventDefault(); const key=e.dataTransfer.getData('text/plain'); if(key) fill(dz,key); });
    dz.addEventListener('dblclick',()=>clear(dz));
  });
  drops.forEach(dz=>{ const saved=localStorage.getItem(LS+dz.id); if(saved) fill(dz, saved); else dz.textContent=dz.dataset.label; });
  document.getElementById('resetDD').addEventListener('click',()=>drops.forEach(clear));
})();

/* ===== Footer nav (save first) ===== */
(function(){
  document.querySelectorAll('footer.nav a').forEach(a=>{
    a.addEventListener('click', e=>{
      e.preventDefault();
      window.__sp_collectReadingAnswers?.();
      window.location.href = a.getAttribute('href');
    });
  });
})();

/* ===== Ensure timer badge ===== */
(function(){
  if(!document.getElementById('timer')){
    const badge=document.createElement('span');
    badge.id='timer'; badge.className='timer'; badge.textContent='60:00';
    const header=document.querySelector('.appbar'); const meta=document.querySelector('.appbar .meta');
    if(header) header.insertBefore(badge, meta||null);
  }
})();

/* ===== 60-minute countdown (shared) ===== */
(function(){
  const DMS=60*60*1000, END='sp_reading_end_ts', DONE='sp_reading_done';
  const timer=document.getElementById('timer');
  let end=parseInt(localStorage.getItem(END)||'0',10); const now=Date.now();
  if(!end || end<now){ end=now+DMS; localStorage.setItem(END,String(end)); localStorage.removeItem(DONE); }
  const fmt=n=>String(n).padStart(2,'0');
  function tick(){
    if(localStorage.getItem(DONE)==='1'){ redirect(); return; }
    const remain=(parseInt(localStorage.getItem(END)||String(end),10))-Date.now();
    if(remain<=0){ if(timer) timer.textContent='00:00'; finalizeAndRedirect(); return; }
    const sec=Math.floor(remain/1000), m=Math.floor(sec/60), s=sec%60;
    if(timer) timer.textContent=`${fmt(m)}:${fmt(s)}`; setTimeout(tick,250);
  }
  function finalizeAndRedirect(){
    try{ document.querySelectorAll('input, select, textarea, button').forEach(el=>{ if(el.id!=='themeToggle') el.disabled=true; }); }catch{}
    window.__sp_collectReadingAnswers?.();
    localStorage.setItem('sp_reading_submitted_at', new Date().toISOString());
    localStorage.setItem(DONE,'1'); setTimeout(redirect,300);
  }
  function redirect(){ window.location.href='writing.html'; }
  tick();
})();

/* ===== Proceed button ===== */
(function(){
  function proceed(){
    window.__sp_collectReadingAnswers?.();
    localStorage.setItem('sp_reading_done','1');
    localStorage.setItem('sp_reading_submitted_at', new Date().toISOString());
    window.location.href='writing.html';
  }
  const btn=document.getElementById('proceedBtn'); if(btn) btn.addEventListener('click', proceed);
})();
</script>
</body>
</html>
